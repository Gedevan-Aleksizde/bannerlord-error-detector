<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <style>
        .button {
            float: right;
            margin-left: 10px
        }

        .monospace {
            font-family: 'Lucida Console', Courier, monospace;
        }

        #title {
            float: left
        }

        .msg {
            display: none
        }

        #dsc {
            padding-top: 0px;
            padding-bottom: 5px;
        }

        img {
            float: left;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .border-blue {
            padding: 5px;
            background-color: lightblue;
            border: 1px solid darkblue;
            position: relative;
            min-height: 48px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .mod-list{
            margin: 5px;
            background-color:whitesmoke;
            border: 1px solid grey;
            padding: 5px;

        }
        .mod-list-tw {
            margin: 5px;
            background-color: whitesmoke;
            border: 1px solid grey;
            padding: 5px;
        }
        .mod-list-unloaded {
            margin: 5px;
            background-color: whitesmoke;
            border: 1px solid grey;
            padding: 5px;
            color: grey
        }
        #xml-report-table {
            border-collapse: collapse;
        }
        td{
            vertical-align:middle
        }
        #bewVersion {
            font-size: small;
            color: darkgrey;
            
        }

    </style>
</head>
<body>
    <div style='clear:both;'>
        <h1 id='title'> An unhandled exception occured! </h1>
        <button class='button' onclick='window.external.Close()'>
            Attempt to continue
        </button>
        <button class='button' onclick='window.external.CloseProgram()'>
            Close the program
        </button>
        <button class='button' onclick='SavePage()'>
            Save/Print this page
        </button>
    </div>
    <br />
    <br />
    <hr />
    <table style='width: 100%; '>
        <tbody>
            <tr>
                <td style='width: 64px; '>
                    <img src='http://icons.iconarchive.com/icons/paomedia/small-n-flat/256/sign-error-icon.png' width='64' height='64' />
                </td>
                <td>
                    <p>
                        <b>Bannerlord has encountered a problem and needs to close. We are sorry for the inconvenience. </b><br />
                        If you were in the middle of something, the progress you were working on might be lost.<br />
                        This error can be caused by a faulty module XMLs, manifest (submodule.xml), or module error (.net execution error or permission error).<br /><br />
                        
                        Or If you are debugging, you can disable the error window individually in <a href='#' onclick='window.external.OpenConfig()'><b>config.json</b></a> in BetterExceptionWindow submodule folder.
                    </p>
                </td>
            </tr>
        </tbody>
    </table>
    <br />
    <h2 name='reason'>
        <a href='#reason' onclick='spoiler(this, "Reasons" ,"reason")'>
            + Reason
        </a>
    </h2>
    <div class='msg' id='reason'>
        Source: <span>{faultingSource}</span>
        <p class='monospace' id='reasonPre'>
            {errorString}
        </p>
    </div>
    <h2 name='innerexcept'>
        <a href='#innerexcept' onclick='spoiler(this, "Inner exception" ,"innerexcept")'>
            + Inner exception
        </a>
    </h2>
    <div class='msg' id='innerexcept'>
        Source: <span>{innerFaultingSource}</span>
        <p class='monospace' id='reasonPre'>
            {innerException}
        </p>
    </div>
    <h2 name='fullStack'>
        <a href='#fullStack' onclick='spoiler(this, "Callstacks" ,"fullStack")'>
            + Callstacks
        </a>
    </h2>
    <div class='msg' id='fullStack'>
        <p>
            <b>Protip: </b>
            Use a debugger like <a href='https://github.com/0xd4d/dnSpy'>dnSpy</a> or
            <a href='https://visualstudio.microsoft.com/'>Visual studio</a> to trace the source of error, by stepping the program
            line by line.
        </p>
        Inner exception callstack:
        <pre>{innerExceptionCallStack}</pre>
        Outer exception callstack:
        <pre>{fullStackString}</pre>
    </div>
    <h2 name='mods'>
        <a href='#mods' onclick='spoiler(this, "Installed mods" ,"mods")'>
            + Installed mods
        </a>
    </h2>
    <div class='msg' id='mods'>
        <p><input type='checkbox' onclick='hideTWMods(this)' /> Hide taleworlds mods </p>
        <p><input type='checkbox' onclick='hideUnloadedMods(this)' /> Hide unloaded mods</p>
        <div id="mod-container">
            
        </div>
    </div>
    <h2 name='loaded-dll'>
        <a href='#loaded-dll' onclick='spoiler(this, "Loaded DLLs" ,"dll")'>
            + Loaded DLLs
        </a>
    </h2>
    <div class='msg' id='dll'>
        <p><input type='checkbox' onclick='hide(this)' /> Hide taleworlds dll </p>
        <ul>
            {installedMods}
        </ul>
    </div>
    <h2 name="rgl">
        <a href='#rgl-log' onclick='spoiler(this, "Game Engine Log" ,"rgl-log")'>
            + Game Engine Logs
        </a>
    </h2>
    <div class='msg' id='rgl-log'>
        <p>
            <img src="https://icons.iconarchive.com/icons/dtafalonso/modern-xp/256/ModernXP-43-Date-New-icon.png" width="64" height="64" />
            Recorded logs from the game engine (RGL). Taken at {logtime}
        </p>
        <br/>
        <pre>{gameLogs}</pre>
    </div>
    <h2 name="harmony">
        <a href='#harmony-log' onclick='spoiler(this, "Harmony Patches" ,"harmony")'>
            + Harmony Patches
        </a>
    </h2>
    <div class='msg' id='harmony'>
        <p>
            {harmonyLog}
        </p>
    </div>
    <h2 name="troubleshoot">
        <a href='#troubleshoot' onclick='spoiler(this, "Troubleshoot" ,"troubleshoot")'>
            + Troubleshoot
        </a>
    </h2>
    <div class='msg' id='troubleshoot'>
        <p>You can try several troubleshoot options down below.</p>
        <div class='border-blue' id='xml-report'>
            <img src='http://icons.iconarchive.com/icons/dtafalonso/modern-xp/512/ModernXP-64-Folder-Check-icon.png' width='48' />
            Check for XML typos if an error were caused by faulty XMLs, tap the button on the right to validate them.
            <button onclick='validateXML(this)' id='btn-validate-xml'  style='position:absolute;right:5px;'>Check XML validity</button>
            <br />
            <table id='xml-report-table' style='width:100%; display:none' border='0'>
                <tr>
                    <td style='width:30px'><img src='http://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/sign-check-icon.png' width='24' /> </td>
                    <td>
                        Submodule.xml <br />
                        Location: <a href='#' onclick='test()'>C:\FILE\Submodule.xml</a>
                        Location: <a href='#' onclick='stopsearch()'>C:\FILE\Submodule.xml</a>
                        Location: <a href='#' onclick='clearTable()'>C:\FILE\Submodule.xml</a>
                    </td>
                </tr>
            </table>
        </div>        
        <div class='border-blue'>
            <img src='http://icons.iconarchive.com/icons/dtafalonso/modern-xp/512/ModernXP-70-Window-Settings-icon.png' width='48' />
            Attempt to disable faulty mods. This option may only work with the original Taleworlds Launcher.
            <button style='position:absolute;right:5px;' onclick="window.external.DisableProblematicModules()">Disable them</button>
        </div>
        <div class='border-blue'>
            <img src='http://icons.iconarchive.com/icons/dtafalonso/modern-xp/512/ModernXP-65-Floppy-Save-icon.png' width='48' />
            Emergency save. <br />
            Forcefully to save the game. This might not work!
            <button style='position:absolute;right:5px;' onclick="saveEmergencyCampaign()">Save the game</button>
        </div>
        <p id="log">

        </p>
    </div>
    <div id="jsonData" style="display:none">
        {jsonData}
    </div>
    <div id="takenTroubleshootActions" style="display:none">
        {jsonTroubleshoot}
    </div>
	<div id="saveblobsBase64" style="display:none">
	    work in progress
	</div>
	<hr />
	<small id="bewVersion">Generated by BetterExceptionWindow version </small>
    <script>
        //https://github.com/douglascrockford/JSON-js/blob/master/json2.js
        if (typeof JSON !== "object") {
            JSON = {};
        }

        (function () {
            "use strict";

            var rx_one = /^[\],:{}\s]*$/;
            var rx_two = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;
            var rx_three = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;
            var rx_four = /(?:^|:|,)(?:\s*\[)+/g;
            var rx_escapable = /[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
            var rx_dangerous = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;

            function f(n) {
                // Format integers to have at least two digits.
                return (n < 10)
                    ? "0" + n
                    : n;
            }

            function this_value() {
                return this.valueOf();
            }

            if (typeof Date.prototype.toJSON !== "function") {

                Date.prototype.toJSON = function () {

                    return isFinite(this.valueOf())
                        ? (
                            this.getUTCFullYear()
                            + "-"
                            + f(this.getUTCMonth() + 1)
                            + "-"
                            + f(this.getUTCDate())
                            + "T"
                            + f(this.getUTCHours())
                            + ":"
                            + f(this.getUTCMinutes())
                            + ":"
                            + f(this.getUTCSeconds())
                            + "Z"
                        )
                        : null;
                };

                Boolean.prototype.toJSON = this_value;
                Number.prototype.toJSON = this_value;
                String.prototype.toJSON = this_value;
            }

            var gap;
            var indent;
            var meta;
            var rep;


            function quote(string) {

                // If the string contains no control characters, no quote characters, and no
                // backslash characters, then we can safely slap some quotes around it.
                // Otherwise we must also replace the offending characters with safe escape
                // sequences.

                rx_escapable.lastIndex = 0;
                return rx_escapable.test(string)
                    ? "\"" + string.replace(rx_escapable, function (a) {
                        var c = meta[a];
                        return typeof c === "string"
                            ? c
                            : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4);
                    }) + "\""
                    : "\"" + string + "\"";
            }


            function str(key, holder) {

                // Produce a string from holder[key].

                var i;          // The loop counter.
                var k;          // The member key.
                var v;          // The member value.
                var length;
                var mind = gap;
                var partial;
                var value = holder[key];

                // If the value has a toJSON method, call it to obtain a replacement value.

                if (
                    value
                    && typeof value === "object"
                    && typeof value.toJSON === "function"
                ) {
                    value = value.toJSON(key);
                }

                // If we were called with a replacer function, then call the replacer to
                // obtain a replacement value.

                if (typeof rep === "function") {
                    value = rep.call(holder, key, value);
                }

                // What happens next depends on the value's type.

                switch (typeof value) {
                    case "string":
                        return quote(value);

                    case "number":

                        // JSON numbers must be finite. Encode non-finite numbers as null.

                        return (isFinite(value))
                            ? String(value)
                            : "null";

                    case "boolean":
                    case "null":

                        // If the value is a boolean or null, convert it to a string. Note:
                        // typeof null does not produce "null". The case is included here in
                        // the remote chance that this gets fixed someday.

                        return String(value);

                    // If the type is "object", we might be dealing with an object or an array or
                    // null.

                    case "object":

                        // Due to a specification blunder in ECMAScript, typeof null is "object",
                        // so watch out for that case.

                        if (!value) {
                            return "null";
                        }

                        // Make an array to hold the partial results of stringifying this object value.

                        gap += indent;
                        partial = [];

                        // Is the value an array?

                        if (Object.prototype.toString.apply(value) === "[object Array]") {

                            // The value is an array. Stringify every element. Use null as a placeholder
                            // for non-JSON values.

                            length = value.length;
                            for (i = 0; i < length; i += 1) {
                                partial[i] = str(i, value) || "null";
                            }

                            // Join all of the elements together, separated with commas, and wrap them in
                            // brackets.

                            v = partial.length === 0
                                ? "[]"
                                : gap
                                    ? (
                                        "[\n"
                                        + gap
                                        + partial.join(",\n" + gap)
                                        + "\n"
                                        + mind
                                        + "]"
                                    )
                                    : "[" + partial.join(",") + "]";
                            gap = mind;
                            return v;
                        }

                        // If the replacer is an array, use it to select the members to be stringified.

                        if (rep && typeof rep === "object") {
                            length = rep.length;
                            for (i = 0; i < length; i += 1) {
                                if (typeof rep[i] === "string") {
                                    k = rep[i];
                                    v = str(k, value);
                                    if (v) {
                                        partial.push(quote(k) + (
                                            (gap)
                                                ? ": "
                                                : ":"
                                        ) + v);
                                    }
                                }
                            }
                        } else {

                            // Otherwise, iterate through all of the keys in the object.

                            for (k in value) {
                                if (Object.prototype.hasOwnProperty.call(value, k)) {
                                    v = str(k, value);
                                    if (v) {
                                        partial.push(quote(k) + (
                                            (gap)
                                                ? ": "
                                                : ":"
                                        ) + v);
                                    }
                                }
                            }
                        }


                        v = partial.length === 0
                            ? "{}"
                            : gap
                                ? "{\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "}"
                                : "{" + partial.join(",") + "}";
                        gap = mind;
                        return v;
                }
            }


            if (typeof JSON.stringify !== "function") {
                meta = {    // table of character substitutions
                    "\b": "\\b",
                    "\t": "\\t",
                    "\n": "\\n",
                    "\f": "\\f",
                    "\r": "\\r",
                    "\"": "\\\"",
                    "\\": "\\\\"
                };
                JSON.stringify = function (value, replacer, space) {


                    var i;
                    gap = "";
                    indent = "";



                    if (typeof space === "number") {
                        for (i = 0; i < space; i += 1) {
                            indent += " ";
                        }


                    } else if (typeof space === "string") {
                        indent = space;
                    }


                    rep = replacer;
                    if (replacer && typeof replacer !== "function" && (
                        typeof replacer !== "object"
                        || typeof replacer.length !== "number"
                    )) {
                        throw new Error("JSON.stringify");
                    }

                    return str("", { "": value });
                };
            }

            

            if (typeof JSON.parse !== "function") {
                JSON.parse = function (text, reviver) {


                    var j;

                    function walk(holder, key) {

                        var k;
                        var v;
                        var value = holder[key];
                        if (value && typeof value === "object") {
                            for (k in value) {
                                if (Object.prototype.hasOwnProperty.call(value, k)) {
                                    v = walk(value, k);
                                    if (v !== undefined) {
                                        value[k] = v;
                                    } else {
                                        delete value[k];
                                    }
                                }
                            }
                        }
                        return reviver.call(holder, key, value);
                    }


                    text = String(text);
                    rx_dangerous.lastIndex = 0;
                    if (rx_dangerous.test(text)) {
                        text = text.replace(rx_dangerous, function (a) {
                            return (
                                "\\u"
                                + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                            );
                        });
                    }


                    if (
                        rx_one.test(
                            text
                                .replace(rx_two, "@")
                                .replace(rx_three, "]")
                                .replace(rx_four, "")
                        )
                    ) {

                        j = eval("(" + text + ")");
                        return (typeof reviver === "function")
                            ? walk({ "": j }, "")
                            : j;
                    }


                    throw new SyntaxError("JSON.parse");
                };
            }
        }());
    </script>
    <script>
		var TroubleshootAction = {
			ForceSave: false,
			XMLCheck: false
		}

        if (!document.getElementsByClassName) {
            document.getElementsByClassName = function (search) {
                var d = document, elements, pattern, i, results = [];
                if (d.querySelectorAll) { // IE8
                    return d.querySelectorAll("." + search);
                }
                if (d.evaluate) { // IE6, IE7
                    pattern = ".//*[contains(concat(' ', @class, ' '), ' " + search + " ')]";
                    elements = d.evaluate(pattern, d, null, 0, null);
                    while ((i = elements.iterateNext())) {
                        results.push(i);
                    }
                } else {
                    elements = d.getElementsByTagName("*");
                    pattern = new RegExp("(^|\\s)" + search + "(\\s|$)");
                    for (i = 0; i < elements.length; i++) {
                        if (pattern.test(elements[i].className)) {
                            results.push(elements[i]);
                        }
                    }
                }
                return results;
            }
        }
        if (typeof Array.isArray === 'undefined') {
            Array.isArray = function (obj) {
                return Object.prototype.toString.call(obj) === '[object Array]';
            }
        };
        function spoiler(e, msg, el) {
            if (document.getElementById(el).style.display == 'block') {
                document.getElementById(el).style.display = 'none';
                e.innerHTML = '+ ' + msg
            }
            else {
                document.getElementById(el).style.display = 'block';
                e.innerHTML = '- ' + msg
            }
        }
        function hide(e) {
            var list = document.getElementsByClassName('taleworlds_ul')
            for (var i = 0; i < list.length; i++) {
                list[i].style.display = (e.checked) ? 'none' : 'list-item';
            }
        }
        function hideUnloadedMods(e) {
            var list = document.getElementsByClassName('mod-list-unloaded')
            for (var i = 0; i < list.length; i++) {
                list[i].style.display = (e.checked) ? 'none' : 'block';
            }
        }
        function hideTWMods(e) {
            var list = document.getElementsByClassName('mod-list-tw')
            for (var i = 0; i < list.length; i++) {
                list[i].style.display = (e.checked) ? 'none' : 'block';
            }
        }
        function validateXML(e) {
            e.disabled = true;
            clearTable();
            var table = document.getElementById('xml-report-table'),
                xmlReport = document.getElementById('xml-report'),
                row = table.insertRow(0),
                icon = row.insertCell(0),
                desc = row.insertCell(1);
            icon.style.width = '30px';
            icon.innerHTML = '';
            desc.innerHTML = '<img id="search-icon" style="vertical-align:middle; float:none" src="http://fc06.deviantart.net/fs71/f/2012/331/f/4/windows_gif__searching_folder_files_by_timocop-d5mbp7w.gif" /><span id="scan-status" style="vertical-align: middle;">Checking file...</span>';
            table.style.display = 'block';
            xmlReport.style.backgroundColor = 'lightgoldenrodyellow';
            window.external.ScanAndLintXmls();
        }

        function doneScanning() {
            document.getElementById("search-icon").remove();
            document.getElementById("scan-status").innerText = "XML checks done.";
			TroubleshootAction.XMLCheck = true;
			
        }
        function saveEmergencyCampaign() {
            var result = confirm("Depending on the crash, this might not work!\n Only use this if you're in: Campaign map and the crash is not player data related (i.e caused by corrupt party tables, items, or anything that is stored into save file)! \nContinue to forcefully save the game?");
            if (result) {
                var filename = prompt("Save as");
                if (!filename) {
                    alert("invalid name");
                }
                else {
                    if (window.external.ForceSave(filename)) {
                        alert("game saved as " + filename);
                    }
                }
                
            }
            
        }
        function clearTable() {
            var elmtTable = document.getElementById('xml-report-table');
                tableRows = elmtTable.getElementsByTagName('tr'),
                rowCount = tableRows.length;

            for (var x = 0; x < rowCount; x++) {
                elmtTable.deleteRow(0);
            }
        }
        function test() {
            addXMLDiagResult('FILE.xml', 'C:/FILE/FILE.xml', "invalid at line");
        }
        function stopsearch() {
            finishSearch(true);
        }
        function finishSearch(withError) {
            var xmlReport = document.getElementById('xml-report'),
                table = document.getElementById('xml-report-table'),
                searchBtn = document.getElementById('btn-validate-xml');
            xmlReport.style.backgroundColor = (withError) ? 'lightgoldenrodyellow' : 'darkseagreen';
            table.deleteRow(0);
            searchBtn.disabled = false;
        }
        function addXMLDiagResult(filename, path, error) {
            var table = document.getElementById('xml-report-table'),
                row = table.insertRow(-1),
                icon = row.insertCell(0),
                desc = row.insertCell(1);
            icon.style.width = '30px';
            if (!error)
                icon.innerHTML = '<img src="http://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/sign-check-icon.png" width="24" /> ';
            else
                icon.innerHTML = '<img src="http://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/sign-warning-icon.png" width="24" /> ';
            var res = '<div><b>' + filename + '</b><div><div>' + 'Location: ' + '<a onclick="openPath(\"' + path + '\")">' + path + '</a></div>' ;
            if (error)
                res = res + '<div>' + error + '</div>';
            desc.innerHTML = res + "<hr />";

        }

        function AnalyseModule() {
            var jsonData = JSON.parse(document.getElementById("jsonData").innerText);
            for (var i = 0; i < jsonData.length; i++) {
                DisplayModulesReport(jsonData[i]);
            }
        }
        function DisplayModulesReport(data) {
            var d = document.getElementById("log");
            try {
                var modContainer = document.getElementById('mod-container'),
                    newModContent = document.createElement('div'),
                    modHeader = document.createElement('b'),
                    anchorInHeader = document.createElement('a'),
                    modDetail = document.createElement('div'),
                    modDetailUl = document.createElement('ul'),
                    modDependsUl = document.createElement('ul'),
                    modSubModulesUl = document.createElement('ul');

                try {
                    newModContent.className = (data.Module.Official["@value"]) ? "mod-list-tw" : "mod-list";
                }
                catch (e) {
                    newModContent.className = "mod-list";
                }
                newModContent.className = data.isModLoaded ? newModContent.className : "mod-list-unloaded";
                if (data.isFaultingMod) {
                    newModContent.style.backgroundColor = "lightpink";
                }

                anchorInHeader.innerText = "+ " + data.Module.Name["@value"] + " (version: " + data.Module.Version["@value"] + ")";            
                anchorInHeader.href = "#" + data.Module.Id["@value"];            

                modDetail.id = data.Module.Id["@value"];
                modDetail.style.display = "none";
            
                var labelModInformation = document.createElement('div'),
                    modLoadedLi = document.createElement('li'),
                    pdbIncludedLi = document.createElement('li'),
                    modIdLi = document.createElement('li'),
                    modVersionLi = document.createElement('li'),
                    modLocationLi = document.createElement('li'),
                    modManifestLocationLi = document.createElement('li'),
                    labelDependsOn = document.createElement('div'),
                    labelSubModules = document.createElement('div');
                
                labelModInformation.innerText = "Mod manifest data:";
                modLoadedLi.innerText = (data.isModLoaded) ? "Mod loaded: YES" : "Mod loaded: NO";
                modIdLi.innerText = "Mod Id: " + data.Module.Id["@value"];
                modVersionLi.innerText = "Mod Version: " + data.Module.Version["@value"];
                modLocationLi.innerText = "Mod Location: " + data.location;
                modManifestLocationLi.innerText = "Mod Manifest location: " + data.manifest;
                labelDependsOn.innerText = "Depends on:";
                labelSubModules.innerText = "Submodules:";

                if (!data.Module.DependedModules || !data.Module.DependedModules.DependedModule || Array.isArray(data.Module.DependedModules.DependedModule) && data.Module.DependedModules.DependedModule.length == 0) {
                    var node = document.createElement('li');
                    node.innerText = "Does not depend with other module";
                    modDependsUl.appendChild(node);
                }
                else if (!Array.isArray(data.Module.DependedModules.DependedModule)) {
                    var node = document.createElement('li');
                    if ( data.Module.DependedModules.DependedModule) 
                        node.innerText = data.Module.DependedModules.DependedModule["@Id"];
                    else
                        node.innerText = "Does not dependwith other module";                
                    modDependsUl.appendChild(node);
                }
                else {
                    for (var i = 0; i < data.Module.DependedModules.DependedModule.length; i++) {
                        var node = document.createElement('li');
                        node.innerText = data.Module.DependedModules.DependedModule[i]["@Id"];
                        modDependsUl.appendChild(node);
                    }
                }

                if (!data.Module.SubModules || !data.Module.SubModules.SubModule || !Array.isArray(data.Module.SubModules.SubModule) && data.Module.SubModules.SubModule.length == 0) {
                    var node = document.createElement('li');
                    node.innerText = "Does not contain any DLL module";
                    modSubModulesUl.appendChild(node);
                }
                else if (!Array.isArray(data.Module.SubModules.SubModule)) {
                    var node = document.createElement('li');
                    if (data.Module.SubModules.SubModule.DLLName) {
                        node.innerText = data.Module.SubModules.SubModule.DLLName["@value"];
                    }
                    else
                        node.innerText = "Does not contain any DLL module";                   
                    modSubModulesUl.appendChild(node);

                }
                else {
                    for (var i = 0; i < data.Module.SubModules.SubModule.length; i++) {
                        var node = document.createElement('li');
                        if (data.Module.SubModules.SubModule[i].isLoadedInMemory) {
                            node.innerText = data.Module.SubModules.SubModule[i].DLLName["@value"];
                        }
                        else {
                            node.innerHTML = "<del>" + data.Module.SubModules.SubModule[i].DLLName["@value"] + "</del> (Not loaded in memory)" ;
                        }

                        modSubModulesUl.appendChild(node);
                    }
                }
            

                modDetail.appendChild(labelModInformation);
                modDetailUl.appendChild(modLoadedLi);
                modDetailUl.appendChild(modIdLi);
                modDetailUl.appendChild(modVersionLi);
                modDetailUl.appendChild(modManifestLocationLi);
                modDetail.appendChild(modDetailUl);
                modDetail.appendChild(labelDependsOn);
                modDetail.appendChild(modDependsUl);
                modDetail.appendChild(labelSubModules);
                modDetail.appendChild(modSubModulesUl);

                modHeader.appendChild(anchorInHeader);
                newModContent.appendChild(modHeader);
                newModContent.appendChild(modDetail);

                modContainer.appendChild(newModContent);
                anchorInHeader.onclick = function () {
                    spoiler(anchorInHeader, data.Module.Name["@value"] + "(version: " + data.Module.Version["@value"] + ")", data.Module.Id["@value"]);
                }
            }
            catch (e) {
                alert(e.message + "  " + data.Module.Name["@value"] + "\r\n" + "at js function " + "DisplayModulesReport");
                var d = document.getElementById("log");
                d.innerText = moduleJSON;
            }

        }
		
        function RecordTakenAction() {
            document.getElementById("takenTroubleshootActions").innerText = JSON.stringify(TroubleshootAction);
        }
        function SavePage() {
            alert("tessssttttt!");
            RecordTakenAction();
            window.external.Save();
        }
        AnalyseModule();
        RecordTakenAction();
    </script>
</body>
</html>